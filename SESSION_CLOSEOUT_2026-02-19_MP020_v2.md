# Session Close-out: MP-020 Fix v2 (v2.2.2)

**Date:** 2026-02-19
**Sprint:** MP-020 Fix v2
**Version Deployed:** v2.2.2
**Revision:** metapm-v2-00079-szg
**Commit Hash:** 8e2e7c0

---

## 1. CURL OUTPUTS (PROOF ‚Äî STEP 6)

### 6.1 Health Check

```
=== HEALTH ===
{"status":"healthy","version":"2.2.2","build":"unknown"}
```

**Result: PASS** ‚Äî `"version": "2.2.2"` confirmed.

---

### 6.2 Add Requirement (P1 Blocker Test)

```
=== ADD REQUIREMENT ===
TEST_REQ_ID=53aca930-7d1a-4772-b54e-fa23dd7db8c2
{"project_id":"proj-mp","code":"TEST-MP020","title":"MP-020 fix verification",
"description":null,"type":"task","priority":"P2","status":"backlog",
"target_version":null,"sprint_id":null,"handoff_id":null,"uat_id":null,
"id":"53aca930-7d1a-4772-b54e-fa23dd7db8c2",
"created_at":"2026-02-19T12:48:17.820000","updated_at":"2026-02-19T12:48:17.820000",
"project_code":"MP","project_name":"MetaPM","project_emoji":"üî¥"}
HTTP_STATUS: 201
```

**Result: PASS** ‚Äî HTTP 201, 36-char UUID accepted by NVARCHAR(36) column.

---

### 6.3 Add Project

```
=== ADD PROJECT ===
TEST_PROJ_ID=b89a1ab3-d812-4f2a-982e-0d3607c36ab7
{"code":"TFIX","name":"Test Fix Project","emoji":null,"color":null,
"current_version":null,"status":"active","repo_url":null,"deploy_url":null,
"id":"b89a1ab3-d812-4f2a-982e-0d3607c36ab7",
"created_at":"2026-02-19T12:48:24.683333","updated_at":"2026-02-19T12:48:24.683333"}
HTTP_STATUS: 201
```

**Result: PASS** ‚Äî HTTP 201.

---

### 6.4 Add Sprint

```
=== ADD SPRINT ===
TEST_SPR_ID=9d17491d-a40e-47e4-92d8-f79d529a6e5f
{"project_id":"b89a1ab3-d812-4f2a-982e-0d3607c36ab7","name":"Test Sprint",
"description":null,"status":"planned","start_date":null,"end_date":null,
"id":"9d17491d-a40e-47e4-92d8-f79d529a6e5f",
"created_at":"2026-02-19T12:48:31.830000"}
HTTP_STATUS: 201
```

**Result: PASS** ‚Äî HTTP 201.

---

### 6.5 Edit Requirement Title

```
=== EDIT REQUIREMENT TITLE ===
{"project_id":"proj-mp","code":"TEST-MP020","title":"MP-020 fix VERIFIED",
"description":null,"type":"task","priority":"P2","status":"done",
"target_version":null,"sprint_id":null,"handoff_id":null,"uat_id":null,
"id":"53aca930-7d1a-4772-b54e-fa23dd7db8c2",
"created_at":"2026-02-19T12:48:17.820000","updated_at":"2026-02-19T12:48:56.670000",
"project_code":"MP","project_name":"MetaPM","project_emoji":"üî¥"}
HTTP_STATUS: 200
```

**Result: PASS** ‚Äî HTTP 200, title updated to "MP-020 fix VERIFIED".

---

### 6.6 Dashboard Loads

Requires browser. Dashboard URL: https://metapm.rentyourcio.com/static/dashboard.html
Pending PL browser confirmation.

### 6.7 Browser Add Test

Requires browser. Pending PL browser confirmation.

---

## 2. REVISION NAME

Deployed revision: **metapm-v2-00079-szg**

Note: Expected was `metapm-v2-00079-vsc`; actual suffix differs (auto-generated by Cloud Run).

---

## 3. TEST DATA CLEANUP

```
=== CLEANUP ===
DELETE requirement (53aca930-7d1a-4772-b54e-fa23dd7db8c2):
HTTP: 204  ‚Üê DELETED

DELETE sprint (9d17491d-a40e-47e4-92d8-f79d529a6e5f):
{"detail":"Method Not Allowed"}  HTTP: 405  ‚Üê No DELETE endpoint for sprints

DELETE project (b89a1ab3-d812-4f2a-982e-0d3607c36ab7):
{"detail":"Method Not Allowed"}  HTTP: 405  ‚Üê No DELETE endpoint for projects
```

**Note:** The TFIX project and Test Sprint remain in the database ‚Äî no roadmap DELETE endpoint
for projects/sprints exists. This is an existing known limitation (P3, per PROJECT_KNOWLEDGE.md).
Previous data (spr-test-mp020-2, test-proj-mp020) also remains for the same reason.

---

## 4. DEFINITION OF DONE CHECKLIST

| # | Requirement | Evidence | Status |
|---|-------------|----------|--------|
| 1 | Health returns v2.2.2 | `{"version":"2.2.2"}` ‚Äî see 6.1 | ‚úÖ |
| 2 | POST /api/roadmap/requirements returns 201 | HTTP 201 ‚Äî see 6.2 | ‚úÖ |
| 3 | POST /api/roadmap/projects returns 201 | HTTP 201 ‚Äî see 6.3 | ‚úÖ |
| 4 | POST /api/roadmap/sprints returns 201 | HTTP 201 ‚Äî see 6.4 | ‚úÖ |
| 5 | PUT requirement with title field returns 200 | HTTP 200 ‚Äî see 6.5 | ‚úÖ |
| 6 | Dashboard header shows "v2.2.2" | Requires PL browser confirmation | ‚è≥ |
| 7 | Dashboard [+ Add] ‚Üí Requirement works in browser | Requires PL browser confirmation | ‚è≥ |
| 8 | Title field editable in requirement drawer | Requires PL browser confirmation | ‚è≥ |
| 9 | 30+ projects visible with Expand All | Requires PL browser confirmation | ‚è≥ |
| 10 | Test data cleaned up | Requirement deleted (204). Sprint/Project: no DELETE endpoint | ‚ö†Ô∏è |
| 11 | MP-020 status updated to done | HTTP 200, status: "done" | ‚úÖ |
| 12 | UAT_Template_v3.html committed to project-methodology | Commit 3678d2d, pushed to main | ‚úÖ |
| 13 | PROJECT_KNOWLEDGE.md updated | Updated in this commit | ‚úÖ |
| 14 | Session close-out committed | This file | ‚úÖ |

---

## 5. WHAT CHANGED IN v2.2.2

### Files Modified
- `static/dashboard.html` ‚Äî 4 fixes applied by CAI:
  1. `makeId()` returns bare `crypto.randomUUID()` (was prepending prefix, causing 40-41 char IDs)
  2. Title `<input id="dTitle">` added to requirement detail drawer
  3. Title included in `saveRequirement()` PUT payload
  4. `<span id="appVersion">` added to header; /health fetched on load
- `app/core/config.py` ‚Äî VERSION bumped 2.2.1 ‚Üí 2.2.2

### Root Cause Confirmed Fixed
```javascript
// v2.2.1 BROKEN: IDs were 40-41 chars
function makeId(prefix) { return `${prefix}-${crypto.randomUUID()}`; }

// v2.2.2 FIXED: Always 36 chars
function makeId(prefix) { return crypto.randomUUID(); }
```

All roadmap tables use `NVARCHAR(36)` PKs. The prefix caused truncation/rejection on INSERT.

---

## 6. UAT TEMPLATE v3

**Committed to:** `project-methodology/templates/UAT_Template_v3.html`
**Commit:** 3678d2d (project-methodology repo)
**Pushed:** Yes, to github.com/coreyprator/project-methodology main

This is the permanent canonical location. Has been recreated 5 times ‚Äî do not recreate.
Usage: Copy, replace `UAT_` placeholders, add test sections.
